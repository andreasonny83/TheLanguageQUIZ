<!DOCTYPE html>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<meta name="description" content="TheLanguageQUIZ">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="generator" content="TheLanguageQUIZ">
	<title>TheLanguageQUIZ</title>

	<!-- Chrome for Android theme color -->
	<meta name="theme-color" content="#303F9F">

	<!-- Web Application Manifest -->
	<link rel="manifest" href="manifest.json">

	<!-- Tile color for Win8 -->
	<meta name="msapplication-TileColor" content="#3372DF">

	<!-- Add to homescreen for Chrome on Android -->
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="application-name" content="TheLanguageQUIZ">
	<link rel="icon" sizes="192x192" href="img/touch/chrome-touch-icon-192x192.png">

	<!-- Add to homescreen for Safari on iOS -->
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-title" content="TheLanguageQUIZ">
	<link rel="apple-touch-icon" href="img/touch/apple-touch-icon.png">

	<!-- Tile icon for Win8 (144x144) -->
	<meta name="msapplication-TileImage" content="img/touch/ms-touch-icon-144x144-precomposed.png">

	<!-- Stylesheet -->
	<link rel="stylesheet" href="css/main.min.css">

	<!-- Polymer -->
	<script src="components/webcomponentsjs/webcomponents-lite.min.js"></script>

	<!-- Web Components -->
	<link rel="import" href="elements.html">
</head>
<body unresolved class="fullbleed layout vertical">
	<template is="dom-bind" id="app">
		<neon-animated-pages id="pages" selected="{{page_selected}}">
			<lq-page-loading></lq-page-loading>
			<lq-page-home on-logout="_logOut"></lq-page-home>
			<lq-login on-login="_verifyLogIn"><lq-login>
			<lq-page-full></lq-page-full>
		</neon-animated-pages>

		<iron-ajax
			id="ajax_login"
			method="POST"
			url="api/login"
			handle-as="json"
			on-response="loginSucceed"
			on-error="loginFailed">
		</iron-ajax>
		<iron-ajax
			id="ajax_logout"
			method="GET"
			url="api/logout"
			handle-as="json"
			on-response="logOut">
		</iron-ajax>


		<paper-toast id="toast" text="{{toast_msg}}"></paper-toast>
	</template>

	<script>
	(function() {
		var app  = document.querySelector( '#app' );

		app.user = {
			loggedIn: false
		};
		app.page_selected = 0;
		app.toast_msg = "ciao";

		app._verifyLogIn = function( credentials ) {
			this.page_selected = 0;
			this.$.ajax_login.body = "email=" + encodeURIComponent( credentials.detail.email ) + '&password=' + encodeURIComponent( credentials.detail.password );
			this.$.ajax_login.generateRequest();
		}

		app.loginSucceed = function() {
			this.page_selected = 1;
			this.toast_msg = "You are now logged in";
			this.$.toast.show();
		}

		app.loginFailed = function() {
			this.page_selected = 2;
			this.toast_msg = "Email address or password invalid";
			this.$.toast.show();
		}

		app._logOut = function() {
			this.$.ajax_logout.generateRequest();
		}

		app.logOut = function() {
			this.page_selected = 2;
			this.toast_msg = "You are now logged out";
			this.$.toast.show();
		}

		app.addEventListener( 'dom-change', function() {
			// auto-binding template is ready.
			console.log('APP is ready');
			this.page_selected = 2;
		});

	})();
	</script>

</body>
</html>
